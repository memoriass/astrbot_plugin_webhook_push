<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <!-- 移除外部字体，防止 Docker 网络阻塞 -->

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            /* 禁止任何默认边框和轮廓 */
            outline: none;
            border: none;
        }

        body {
            background: transparent;
            /* 强制字体栈，优先使用常见中文字体，最后回退到 sans-serif */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", "Microsoft YaHei", "PingFang SC", sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.5;
            /* 统一行高 */
        }

        /* 彻底清除列表默认样式，防止出现奇怪的符号（如半圆对勾） */
        ul,
        li {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        img {
            max-width: 100%;
            display: block;
            /* 防止图片底部出现几像素空白 */
            border: 0;
            /* 移除图片边框 */
        }

        /* News Card Style (Ref: andytran) */
        .post-module {
            position: relative;
            z-index: 1;
            display: block;
            background: #FFFFFF;
            min-width: 420px;
            max-width: 420px;
            height: auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.15);
            transition: all 0.3s linear 0s;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        /* Thumbnail Section */
        .thumbnail {
            background: #2c3e50;
            /* 加深底色，防止白边 */
            height: 240px;
            overflow: hidden;
            /* 强制裁剪溢出内容 */
            position: relative;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .thumbnail img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
            /* 稍微提升不透明度 */
            transition: all 0.3s linear 0s;
            /* 如果图片挂了，这些属性可以隐藏默认的裂图图标 */
            font-size: 0;
            color: transparent;
        }

        /* Float Category Label */
        .category {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 4px 10px;
            /* 更紧凑 */
            border-radius: 2px;
            /* 方形标志 */
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);

            /* 使用注入的 level_color，解决 Docker 环境下 CSS 逻辑失效问题 */
            background: {
                    {
                    level_color | default('#3498db')
                }
            }

            ;
        }

        /* Content Section */
        .post-content {
            position: relative;
            background: #FFFFFF;
            width: 100%;
            padding: 30px 30px 10px 30px;
            flex-grow: 1;
        }

        .title {
            margin: 0;
            padding: 0 0 10px;
            color: #333333;
            font-size: 20px;
            font-weight: 700;
        }

        .sub_title {
            margin: 0;
            padding: 0 0 20px;
            color: #3498db;
            font-size: 14px;
            font-weight: 400;
        }

        .description {
            color: #666666;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
            margin-bottom: 10px;
        }

        /* Post Metadata / Footer - Sticky to bottom */
        .post-meta {
            color: #999999;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #eee;
            padding: 15px 30px;
            margin-top: auto;
            background: #fafafa;
        }

        .timestamp {
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div class="post-module card">
        <!-- Thumbnail -->
        <div class="thumbnail">
            <div class="category">
                {%- set level_map = {
                '严重': 'ERR', '崩溃': 'ERR', 'Error': 'ERR', 'Fatal': 'ERR',
                '警告': 'WARN', 'Warning': 'WARN',
                '成功': 'OK', 'Success': 'OK',
                '信息': 'INFO', '通知': 'INFO', 'Info': 'INFO'
                } -%}
                {%- set level_val_raw = "" -%}
                {%- for item in items -%}
                {%- if item.type == 'kv' and '类型' in item.label -%}
                {%- set level_val_raw = item.value -%}
                {%- endif -%}
                {%- endfor -%}
                {{ level_map.get(level_val_raw, 'INFO') }}
            </div>
            <img src="{{ poster_url }}" alt="Game Background">
        </div>

        <!-- Content -->
        <div class="post-content">
            <h1 class="title">{{ title }}</h1>
            <h2 class="sub_title">游戏通知</h2>

            <div class="description">
                {%- for item in items -%}
                {%- if item.type == 'text' -%}
                {%- if '由 AI' not in item.text and item.text != title -%}
                {{ item.text }}
                {%- if not loop.last -%}<br />{%- endif -%}
                {%- endif -%}
                {%- elif item.type == 'kv' -%}
                {%- if item.label not in ['类型:','类型：','事件:','事件：','时间:','时间：','源:','源：','备注:','备注：'] -%}
                {{ item.label }}{{ item.value }}<br />
                {%- endif -%}
                {%- endif -%}
                {%- endfor -%}
                {%- if '备注:' in message_text -%}
                <div style="margin-top: 10px; font-size: 11px; color: #3498db; opacity: 0.8;">
                    ★ AI 智能语义分析已启用
                </div>
                {%- endif -%}
            </div>
        </div>

        <!-- Footer Meta outside post-content for sticking to bottom -->
        <div class="post-meta">
            <span class="timestamp">
                {{ formatted_time }}
            </span>
            <span class="comments">
                AstrBot Webhook Push
            </span>
        </div>
    </div>
</body>

</html>